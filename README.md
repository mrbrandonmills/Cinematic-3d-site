# Cinematic 3D Site - Dual-Agent System

A scroll-driven cinematic 3D web experience featuring a train station metaphor. Built with Blender for 3D asset creation and Three.js + GSAP for web rendering.

## Table of Contents

- [Overview](#overview)
- [Architecture](#architecture)
- [Tech Stack](#tech-stack)
- [Project Structure](#project-structure)
- [Getting Started](#getting-started)
- [Asset Pipeline (Mac mini)](#asset-pipeline-mac-mini)
- [Web Development](#web-development)
- [Adding New Sections](#adding-new-sections)
- [Troubleshooting](#troubleshooting)

## Overview

This project implements a dual-agent system:

- **Asset Agent**: Creates and optimizes 3D assets using Blender + Python
- **Web/Cinematic Agent**: Builds the scroll-driven web experience using Three.js + GSAP

The two agents communicate through a shared asset folder and metadata contracts.

## Architecture

See [tools/docs/ARCHITECTURE.md](tools/docs/ARCHITECTURE.md) for detailed architecture documentation.

```
┌─────────────────┐
│  Primary Agent  │  Orchestrates workflow
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼───┐ ┌──▼────┐
│ Asset │ │  Web  │
│ Agent │ │ Agent │
└───┬───┘ └──┬────┘
    │         │
    └────┬────┘
         │
   ┌─────▼─────┐
   │  Assets/  │  Shared metadata & GLB files
   └───────────┘
```

## Tech Stack

### 3D Pipeline (Free/Open Source)
- **Blender 3.6+** - 3D modeling and asset creation
- **Python 3.10+** - Automation scripts
- **Draco** - GLB compression

### Web Stack (Free/Open Source)
- **Three.js** - 3D rendering
- **GSAP + ScrollTrigger** - Scroll animations
- **Locomotive Scroll** - Smooth scrolling
- **React + TypeScript** - UI framework
- **Vite** - Build tool

**Total Cost: $0** (100% free and open source)

## Project Structure

```
cinematic-3d-site/
├── assets/
│   ├── models/          # GLB files (generated by Asset Agent)
│   ├── textures/        # Texture files
│   └── meta/            # Asset metadata JSON
│       ├── asset-schema.json
│       ├── style-guide.json
│       ├── asset-list.json
│       └── [asset-id].json
├── web/
│   ├── src/
│   │   ├── components/  # React components
│   │   ├── scenes/      # Three.js scenes
│   │   ├── utils/       # Utility functions
│   │   ├── App.tsx      # Main app
│   │   └── main.tsx     # Entry point
│   ├── public/
│   └── package.json
└── tools/
    ├── blender-scripts/
    │   ├── generate_asset_template.py
    │   ├── bake_and_export.py
    │   ├── asset_automation.py
    │   └── validate_metadata.py
    └── docs/
        ├── ARCHITECTURE.md
        ├── ASSET_AGENT_SPEC.md
        └── WEB_AGENT_SPEC.md
```

## Getting Started

### Prerequisites

**For Asset Creation (Mac mini):**
- Blender 3.6 or later
- Python 3.10+ (included with Blender)

**For Web Development:**
- Node.js 18+ and npm
- Modern web browser with WebGL 2.0 support

### Installation

```bash
# Clone or navigate to the project
cd /Volumes/Super\ Mastery/cinematic-3d-site

# Install web dependencies
cd web
npm install
```

## Asset Pipeline (Mac mini)

### 1. Setup Blender Path

Add Blender to your PATH:

```bash
# For macOS (add to ~/.zshrc or ~/.bash_profile)
export PATH="/Applications/Blender.app/Contents/MacOS:$PATH"

# Reload shell
source ~/.zshrc
```

Verify installation:

```bash
blender --version
```

### 2. Generate a Single Asset

Generate a specific train station asset:

```bash
cd /Volumes/Super\ Mastery/cinematic-3d-site

# Generate station-home
blender -b -P tools/blender-scripts/generate_asset_template.py -- \
  --id station-home \
  --section home

# Generate station-store
blender -b -P tools/blender-scripts/generate_asset_template.py -- \
  --id station-store \
  --section store
```

**What this does:**
- Creates parametric 3D geometry in Blender
- Applies materials from style guide
- Sets up lighting and bakes textures
- Exports optimized GLB to `assets/models/`
- Generates metadata JSON to `assets/meta/`

### 3. Batch Generate All Assets

Generate all planned assets from `asset-list.json`:

```bash
cd /Volumes/Super\ Mastery/cinematic-3d-site

python tools/blender-scripts/asset_automation.py \
  --config assets/meta/asset-list.json
```

**Options:**
- `--dry-run` - Preview what would be generated
- `--id station-name` - Generate only specific asset
- `--force` - Regenerate even if status is not "planned"

### 4. Process Existing Blender Files

If you have custom `.blend` files:

```bash
# Bake textures and export GLB
blender -b your-file.blend -P tools/blender-scripts/bake_and_export.py

# Skip baking (faster, for testing)
blender -b your-file.blend -P tools/blender-scripts/bake_and_export.py -- --no-bake
```

### 5. Validate Asset Metadata

```bash
python tools/blender-scripts/validate_metadata.py assets/meta/station-home.json
```

## Web Development

### 1. Start Development Server

```bash
cd /Volumes/Super\ Mastery/cinematic-3d-site/web

npm run dev
```

Opens at `http://localhost:3000`

### 2. Build for Production

```bash
npm run build
```

Output in `web/dist/`

### 3. Preview Production Build

```bash
npm run preview
```

### 4. Type Check

```bash
npm run type-check
```

### 5. Lint Code

```bash
npm run lint
```

## Adding New Sections

### Step 1: Request New Asset

Describe the new section to the Asset Agent:

```
"Create station-about for the About page.
Theme: Professional, corporate blue tones, clean modern architecture.
Section: about"
```

### Step 2: Asset Agent Generates

The Asset Agent will:
1. Create `assets/models/station-about.glb`
2. Create `assets/meta/station-about.json`
3. Update `assets/meta/asset-list.json`

### Step 3: Web Agent Integrates

Update `web/src/sceneConfig.ts`:

```typescript
{
  id: 'about',
  title: 'About',
  route: '#about',
  assetId: 'station-about',
  cameraFrom: { position: [0, 2, -6], lookAt: [0, 0, 0] },
  cameraTo: { position: [6, 2, 0], lookAt: [0, 0, 0] }
}
```

Update `web/src/App.tsx` to add the section content.

### Step 4: Test

```bash
cd web
npm run dev
```

Scroll to the new section and verify:
- [ ] Asset loads correctly
- [ ] Camera path is smooth
- [ ] Scroll animation works
- [ ] Performance is 60 FPS

## Development Workflow

### Typical Day-to-Day

**Asset Updates:**
```bash
# Make changes to asset
blender assets/station-store.blend

# Re-export
blender -b assets/station-store.blend -P tools/blender-scripts/bake_and_export.py

# Validate
python tools/blender-scripts/validate_metadata.py assets/meta/station-store.json
```

**Web Updates:**
```bash
cd web
npm run dev
# Make changes, see live reload
```

### Git Workflow

```bash
# Commit assets and metadata together
git add assets/models/station-home.glb assets/meta/station-home.json
git commit -m "Add station-home asset"

# Commit web changes
git add web/src/
git commit -m "Integrate station-home section"
```

## Performance Tips

### Asset Optimization

1. **Keep polycount low:**
   - Hero stops: < 50,000 triangles
   - Environment: < 20,000 triangles
   - Props: < 5,000 triangles

2. **Texture resolution:**
   - Use 2048x2048 max for hero assets
   - Use 1024x1024 for environment
   - Use 512x512 for props

3. **Always use Draco compression** (included in export scripts)

### Web Performance

1. **Lazy load assets per section** (already implemented)
2. **Monitor with Chrome DevTools:**
   ```
   Performance → Record → Scroll through sections
   Target: 60 FPS minimum
   ```

3. **Reduce draw calls:**
   - Combine materials where possible
   - Use texture atlases

## Troubleshooting

### Blender Script Errors

**Problem:** `blender: command not found`

**Solution:**
```bash
export PATH="/Applications/Blender.app/Contents/MacOS:$PATH"
source ~/.zshrc
```

**Problem:** Python module not found

**Solution:** Use Blender's Python:
```bash
/Applications/Blender.app/Contents/Resources/3.6/python/bin/python3.10 -m pip install <module>
```

### Asset Loading Issues

**Problem:** GLB file not loading in browser

**Solution:**
1. Check browser console for errors
2. Verify GLB path in metadata matches actual file
3. Test GLB in online viewer: https://gltf-viewer.donmccurdy.com

**Problem:** Textures appear black

**Solution:**
1. Ensure lighting is baked into textures
2. Check material settings in Blender
3. Verify texture export settings

### Performance Issues

**Problem:** Low FPS during scroll

**Solution:**
1. Check polycount of visible assets
2. Profile with Chrome DevTools
3. Reduce texture resolution
4. Implement LOD (Level of Detail)

**Problem:** Slow asset loading

**Solution:**
1. Verify Draco compression is enabled
2. Check file sizes (should be < 3MB per hero asset)
3. Implement progressive loading

### GSAP/Scroll Issues

**Problem:** Camera not moving smoothly

**Solution:**
1. Check `scrub` value in ScrollTrigger (try 1 or 2)
2. Verify camera waypoints in `sceneConfig.ts`
3. Test without Locomotive Scroll first

**Problem:** Sections not triggering

**Solution:**
1. Verify section IDs match between HTML and config
2. Check `start` and `end` values in ScrollTrigger
3. Call `ScrollTrigger.refresh()` after DOM changes

## Resources

- **Blender Docs:** https://docs.blender.org
- **Three.js Docs:** https://threejs.org/docs
- **GSAP Docs:** https://greensock.com/docs
- **Locomotive Scroll:** https://locomotivemtl.github.io/locomotive-scroll

## License

This project is open source and available under the MIT License.

## Support

For issues or questions:
1. Check [tools/docs/](tools/docs/) for detailed specifications
2. Review troubleshooting section above
3. Open an issue on GitHub (if applicable)

---

**Built with** ❤️ **using 100% free and open-source tools**
